<!DOCTYPE html>
<html>
<head>
    <title>–¢–µ—Å—Ç –ª–æ–∫–∞–ª—å–Ω–æ–≥–æ API</title>
    <meta charset="UTF-8">
    <style>
        body { font-family: Arial, sans-serif; margin: 20px; }
        .result { margin: 10px 0; padding: 10px; border: 1px solid #ccc; }
        .success { background-color: #d4edda; border-color: #c3e6cb; }
        .error { background-color: #f8d7da; border-color: #f5c6cb; }
        button { margin: 5px; padding: 10px; }
        #logs { background: #f8f9fa; padding: 10px; border: 1px solid #dee2e6; max-height: 400px; overflow-y: auto; }
    </style>
</head>
<body>
    <h1>üß™ –¢–µ—Å—Ç –ª–æ–∫–∞–ª—å–Ω–æ–≥–æ API</h1>
    
    <div>
        <h3>üîÑ –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ API:</h3>
        <button onclick="testAPI()">–¢–µ—Å—Ç API</button>
        <button onclick="clearLogs()">–û—á–∏—Å—Ç–∏—Ç—å –ª–æ–≥–∏</button>
        <button onclick="testInfiniteLoop()">–¢–µ—Å—Ç –±–µ—Å–∫–æ–Ω–µ—á–Ω–æ–≥–æ —Ü–∏–∫–ª–∞</button>
        <div id="results"></div>
    </div>

    <div>
        <h3>üìã –õ–æ–≥–∏:</h3>
        <div id="logs"></div>
    </div>

    <script>
        let requestCount = 0;
        
        function log(message) {
            const logsDiv = document.getElementById('logs');
            const timestamp = new Date().toLocaleTimeString();
            logsDiv.innerHTML += `<div>[${timestamp}] ${message}</div>`;
            logsDiv.scrollTop = logsDiv.scrollHeight;
        }

        function clearLogs() {
            document.getElementById('logs').innerHTML = '';
        }

        async function testAPI() {
            log('üîÑ –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ API...');
            requestCount++;
            
            try {
                const response = await fetch('http://localhost:3000/api/slots/enhanced?role=candidate&profession=frontend&language=ru&timezone=Asia/Vladivostok');
                const data = await response.json();
                
                log(`‚úÖ API –æ—Ç–≤–µ—Ç –ø–æ–ª—É—á–µ–Ω (–∑–∞–ø—Ä–æ—Å #${requestCount}):`);
                log(`   –°—Ç–∞—Ç—É—Å: ${response.status}`);
                log(`   –°–ª–æ—Ç–æ–≤: ${data.slots?.length || 0}`);
                
                if (data.slots && data.slots.length > 0) {
                    data.slots.forEach(slot => {
                        if (slot.count > 0) {
                            log(`   üìÖ –°–ª–æ—Ç: ${slot.time} (UTC: ${slot.utcTime}) - ${slot.count} —á–µ–ª.`);
                        }
                    });
                }
                
                document.getElementById('results').innerHTML = 
                    `<div class="success"><h4>‚úÖ API —Ä–∞–±–æ—Ç–∞–µ—Ç!</h4><p>–ü–æ–ª—É—á–µ–Ω–æ ${data.slots?.length || 0} —Å–ª–æ—Ç–æ–≤</p></div>`;
                    
            } catch (error) {
                log(`‚ùå –û—à–∏–±–∫–∞ API (–∑–∞–ø—Ä–æ—Å #${requestCount}): ${error.message}`);
                document.getElementById('results').innerHTML = 
                    `<div class="error"><h4>‚ùå –û—à–∏–±–∫–∞ API</h4><p>${error.message}</p></div>`;
            }
        }

        async function testInfiniteLoop() {
            log('üîÑ –¢–µ—Å—Ç –±–µ—Å–∫–æ–Ω–µ—á–Ω–æ–≥–æ —Ü–∏–∫–ª–∞...');
            log('‚ö†Ô∏è –ë—É–¥–µ—Ç –≤—ã–ø–æ–ª–Ω–µ–Ω–æ 5 –∑–∞–ø—Ä–æ—Å–æ–≤ —Å –∏–Ω—Ç–µ—Ä–≤–∞–ª–æ–º 2 —Å–µ–∫—É–Ω–¥—ã');
            
            for (let i = 1; i <= 5; i++) {
                log(`üì° –ó–∞–ø—Ä–æ—Å ${i}/5...`);
                await testAPI();
                if (i < 5) {
                    await new Promise(resolve => setTimeout(resolve, 2000));
                }
            }
            
            log('‚úÖ –¢–µ—Å—Ç –±–µ—Å–∫–æ–Ω–µ—á–Ω–æ–≥–æ —Ü–∏–∫–ª–∞ –∑–∞–≤–µ—Ä—à–µ–Ω');
        }

        // –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ —Ç–µ—Å—Ç–∏—Ä—É–µ–º API –ø—Ä–∏ –∑–∞–≥—Ä—É–∑–∫–µ —Å—Ç—Ä–∞–Ω–∏—Ü—ã
        window.onload = function() {
            log('üöÄ –°—Ç—Ä–∞–Ω–∏—Ü–∞ –∑–∞–≥—Ä—É–∂–µ–Ω–∞, –Ω–∞—á–∏–Ω–∞–µ–º —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ...');
            testAPI();
        };
    </script>
</body>
</html>
