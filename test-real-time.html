<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>–¢–µ—Å—Ç API –≤ —Ä–µ–∞–ª—å–Ω–æ–º –≤—Ä–µ–º–µ–Ω–∏</title>
    <style>
        body { font-family: Arial, sans-serif; margin: 20px; }
        .result { background: #f0f0f0; padding: 10px; margin: 10px 0; border-radius: 5px; }
        .error { background: #ffebee; color: #c62828; }
        .success { background: #e8f5e8; color: #2e7d32; }
        button { padding: 10px 20px; margin: 5px; cursor: pointer; }
        pre { background: #f5f5f5; padding: 10px; overflow-x: auto; }
    </style>
</head>
<body>
    <h1>üîç –¢–µ—Å—Ç API –≤ —Ä–µ–∞–ª—å–Ω–æ–º –≤—Ä–µ–º–µ–Ω–∏</h1>
    
    <div>
        <button onclick="testAPI()">–ü—Ä–æ–≤–µ—Ä–∏—Ç—å API —Å–µ–π—á–∞—Å</button>
        <button onclick="testMultiple()">–¢–µ—Å—Ç –º–Ω–æ–∂–µ—Å—Ç–≤–µ–Ω–Ω—ã—Ö –∑–∞–ø—Ä–æ—Å–æ–≤</button>
        <button onclick="clearResults()">–û—á–∏—Å—Ç–∏—Ç—å —Ä–µ–∑—É–ª—å—Ç–∞—Ç—ã</button>
    </div>
    
    <div id="results"></div>
    
    <script>
        function addResult(title, content, type = 'info') {
            const results = document.getElementById('results');
            const div = document.createElement('div');
            div.className = `result ${type}`;
            div.innerHTML = `<h3>${title}</h3><pre>${content}</pre>`;
            results.appendChild(div);
        }
        
        function clearResults() {
            document.getElementById('results').innerHTML = '';
        }
        
        async function testAPI() {
            const timestamp = new Date().toLocaleString('ru-RU');
            addResult(`üïê –ó–∞–ø—Ä–æ—Å –≤ ${timestamp}`, '–ù–∞—á–∏–Ω–∞–µ–º —Ç–µ—Å—Ç...');
            
            try {
                // –ü–æ–ª—É—á–∞–µ–º —á–∞—Å–æ–≤–æ–π –ø–æ—è—Å –±—Ä–∞—É–∑–µ—Ä–∞
                const timezone = Intl.DateTimeFormat().resolvedOptions().timeZone;
                addResult('üåç –ß–∞—Å–æ–≤–æ–π –ø–æ—è—Å –±—Ä–∞—É–∑–µ—Ä–∞', timezone);
                
                        // –¢–µ—Å—Ç–∏—Ä—É–µ–º API –¥–ª—è –∫–∞–Ω–¥–∏–¥–∞—Ç–æ–≤
        const candidateUrl = `http://localhost:3000/api/slots/enhanced?role=candidate&profession=frontend&language=ru&timezone=${encodeURIComponent(timezone)}`;
        addResult('üì° URL –∑–∞–ø—Ä–æ—Å–∞ –∫–∞–Ω–¥–∏–¥–∞—Ç–∞', candidateUrl);
        
        const candidateResponse = await fetch(candidateUrl);
        const candidateData = await candidateResponse.json();
        
        addResult('‚úÖ –û—Ç–≤–µ—Ç API –¥–ª—è –∫–∞–Ω–¥–∏–¥–∞—Ç–æ–≤', JSON.stringify(candidateData, null, 2), 'success');
        
        // –¢–µ—Å—Ç–∏—Ä—É–µ–º API –¥–ª—è –∏–Ω—Ç–µ—Ä–≤—å—é–µ—Ä–æ–≤
        const interviewerUrl = `http://localhost:3000/api/slots/enhanced?role=interviewer&profession=frontend&language=ru&timezone=${encodeURIComponent(timezone)}`;
        addResult('üì° URL –∑–∞–ø—Ä–æ—Å–∞ –∏–Ω—Ç–µ—Ä–≤—å—é–µ—Ä–∞', interviewerUrl);
        
        const interviewerResponse = await fetch(interviewerUrl);
        const interviewerData = await interviewerResponse.json();
        
        addResult('‚úÖ –û—Ç–≤–µ—Ç API –¥–ª—è –∏–Ω—Ç–µ—Ä–≤—å—é–µ—Ä–æ–≤', JSON.stringify(interviewerData, null, 2), 'success');
                
                // –ê–Ω–∞–ª–∏–∑–∏—Ä—É–µ–º –¥–∞–Ω–Ω—ã–µ
                const slots = candidateData.slots || [];
                addResult('üìä –ê–Ω–∞–ª–∏–∑ —Å–ª–æ—Ç–æ–≤', `–ù–∞–π–¥–µ–Ω–æ —Å–ª–æ—Ç–æ–≤: ${slots.length}`);
                
                slots.forEach(slot => {
                    addResult(`üéØ –°–ª–æ—Ç ${slot.time}`, `–ö–æ–ª–∏—á–µ—Å—Ç–≤–æ: ${slot.count}`, slot.count > 0 ? 'success' : 'error');
                });
                
                // –ü—Ä–æ–≤–µ—Ä—è–µ–º —Å–ª–æ—Ç 23:00
                const slot23 = slots.find(s => s.time === '23:00');
                if (slot23) {
                    addResult('üéØ –°–ª–æ—Ç 23:00 –Ω–∞–π–¥–µ–Ω', `–ö–æ–ª–∏—á–µ—Å—Ç–≤–æ: ${slot23.count}`, slot23.count > 0 ? 'success' : 'error');
                } else {
                    addResult('‚ùå –°–ª–æ—Ç 23:00 –Ω–µ –Ω–∞–π–¥–µ–Ω', '–°–ª–æ—Ç –æ—Ç—Å—É—Ç—Å—Ç–≤—É–µ—Ç –≤ –æ—Ç–≤–µ—Ç–µ API', 'error');
                }
                
            } catch (error) {
                addResult('‚ùå –û—à–∏–±–∫–∞', error.message, 'error');
            }
        }
        
        async function testMultiple() {
            addResult('üîÑ –¢–µ—Å—Ç –º–Ω–æ–∂–µ—Å—Ç–≤–µ–Ω–Ω—ã—Ö –∑–∞–ø—Ä–æ—Å–æ–≤', '–í—ã–ø–æ–ª–Ω—è–µ–º 5 –∑–∞–ø—Ä–æ—Å–æ–≤ –ø–æ–¥—Ä—è–¥...');
            
            for (let i = 1; i <= 5; i++) {
                try {
                    const timezone = Intl.DateTimeFormat().resolvedOptions().timeZone;
                    const response = await fetch(`http://localhost:3000/api/slots/enhanced?role=candidate&profession=frontend&language=ru&timezone=${encodeURIComponent(timezone)}`);
                    const data = await response.json();
                    
                    const slot23 = data.slots?.find(s => s.time === '23:00');
                    const count = slot23 ? slot23.count : 0;
                    
                    addResult(`üîÑ –ó–∞–ø—Ä–æ—Å ${i}`, `–°–ª–æ—Ç 23:00: ${count}`, count > 0 ? 'success' : 'error');
                    
                    // –ù–µ–±–æ–ª—å—à–∞—è –∑–∞–¥–µ—Ä–∂–∫–∞ –º–µ–∂–¥—É –∑–∞–ø—Ä–æ—Å–∞–º–∏
                    await new Promise(resolve => setTimeout(resolve, 500));
                    
                } catch (error) {
                    addResult(`‚ùå –û—à–∏–±–∫–∞ –≤ –∑–∞–ø—Ä–æ—Å–µ ${i}`, error.message, 'error');
                }
            }
        }
        
        // –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–π —Ç–µ—Å—Ç –ø—Ä–∏ –∑–∞–≥—Ä—É–∑–∫–µ —Å—Ç—Ä–∞–Ω–∏—Ü—ã
        window.onload = function() {
            addResult('üöÄ –°—Ç—Ä–∞–Ω–∏—Ü–∞ –∑–∞–≥—Ä—É–∂–µ–Ω–∞', '–ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–π —Ç–µ—Å—Ç —á–µ—Ä–µ–∑ 2 —Å–µ–∫—É–Ω–¥—ã...');
            setTimeout(testAPI, 2000);
        };
    </script>
</body>
</html>
