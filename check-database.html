<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>–ü—Ä–æ–≤–µ—Ä–∫–∞ –±–∞–∑—ã –¥–∞–Ω–Ω—ã—Ö</title>
    <style>
        body { font-family: Arial, sans-serif; margin: 20px; }
        .result { background: #f0f0f0; padding: 10px; margin: 10px 0; border-radius: 5px; }
        .error { background: #ffebee; color: #c62828; }
        .success { background: #e8f5e8; color: #2e7d32; }
        button { padding: 10px 20px; margin: 5px; cursor: pointer; }
        pre { background: #f5f5f5; padding: 10px; overflow-x: auto; }
    </style>
</head>
<body>
    <h1>üîç –ü—Ä–æ–≤–µ—Ä–∫–∞ –±–∞–∑—ã –¥–∞–Ω–Ω—ã—Ö</h1>
    
    <div>
        <button onclick="checkDatabase()">–ü—Ä–æ–≤–µ—Ä–∏—Ç—å –±–∞–∑—É –¥–∞–Ω–Ω—ã—Ö</button>
        <button onclick="addTestInterviewer()" class="btn btn-warning">–î–æ–±–∞–≤–∏—Ç—å —Ç–µ—Å—Ç–æ–≤–æ–≥–æ –∏–Ω—Ç–µ—Ä–≤—å—é–µ—Ä–∞</button>
        <button onclick="addTestCandidate()" class="btn btn-info">–î–æ–±–∞–≤–∏—Ç—å —Ç–µ—Å—Ç–æ–≤–æ–≥–æ –∫–∞–Ω–¥–∏–¥–∞—Ç–∞</button>
        <button onclick="addTestCandidateCorrect()" class="btn btn-success">–î–æ–±–∞–≤–∏—Ç—å –∫–∞–Ω–¥–∏–¥–∞—Ç–∞ –≤ –ø—Ä–∞–≤–∏–ª—å–Ω—ã–π —Å–ª–æ—Ç</button>
        <button onclick="addTestPair()" class="btn btn-primary">–î–æ–±–∞–≤–∏—Ç—å –ø–∞—Ä—É (–∫–∞–Ω–¥–∏–¥–∞—Ç + –∏–Ω—Ç–µ—Ä–≤—å—é–µ—Ä)</button>
        <button onclick="clearTestData()" class="btn btn-danger">–û—á–∏—Å—Ç–∏—Ç—å —Ç–µ—Å—Ç–æ–≤—ã–µ –¥–∞–Ω–Ω—ã–µ</button>
    </div>
    
    <div id="results"></div>
    
    <script>
        function addResult(title, content, type = 'info') {
            const results = document.getElementById('results');
            const div = document.createElement('div');
            div.className = `result ${type}`;
            div.innerHTML = `<h3>${title}</h3><pre>${content}</pre>`;
            results.appendChild(div);
        }
        
        function clearResults() {
            document.getElementById('results').innerHTML = '';
        }
        
        async function checkDatabase() {
            const timestamp = new Date().toLocaleString('ru-RU');
            addResult(`üïê –ü—Ä–æ–≤–µ—Ä–∫–∞ –≤ ${timestamp}`, '–ù–∞—á–∏–Ω–∞–µ–º –ø—Ä–æ–≤–µ—Ä–∫—É –±–∞–∑—ã –¥–∞–Ω–Ω—ã—Ö...');
            
            try {
                const timezone = Intl.DateTimeFormat().resolvedOptions().timeZone;
                addResult('üåç –ß–∞—Å–æ–≤–æ–π –ø–æ—è—Å –±—Ä–∞—É–∑–µ—Ä–∞', timezone);
                
                // –ü—Ä–æ–≤–µ—Ä—è–µ–º API –¥–ª—è –∫–∞–Ω–¥–∏–¥–∞—Ç–æ–≤
                const candidateUrl = `http://localhost:3000/api/slots/enhanced?role=candidate&profession=frontend&language=ru&timezone=${encodeURIComponent(timezone)}`;
                addResult('üì° URL –∑–∞–ø—Ä–æ—Å–∞ –∫–∞–Ω–¥–∏–¥–∞—Ç–∞', candidateUrl);
                
                const candidateResponse = await fetch(candidateUrl);
                const candidateData = await candidateResponse.json();
                
                addResult('‚úÖ –û—Ç–≤–µ—Ç API –¥–ª—è –∫–∞–Ω–¥–∏–¥–∞—Ç–æ–≤', JSON.stringify(candidateData, null, 2), 'success');
                
                // –ü—Ä–æ–≤–µ—Ä—è–µ–º API –¥–ª—è –∏–Ω—Ç–µ—Ä–≤—å—é–µ—Ä–æ–≤
                const interviewerUrl = `http://localhost:3000/api/slots/enhanced?role=interviewer&profession=frontend&language=ru&timezone=${encodeURIComponent(timezone)}`;
                addResult('üì° URL –∑–∞–ø—Ä–æ—Å–∞ –∏–Ω—Ç–µ—Ä–≤—å—é–µ—Ä–∞', interviewerUrl);
                
                const interviewerResponse = await fetch(interviewerUrl);
                const interviewerData = await interviewerResponse.json();
                
                addResult('‚úÖ –û—Ç–≤–µ—Ç API –¥–ª—è –∏–Ω—Ç–µ—Ä–≤—å—é–µ—Ä–æ–≤', JSON.stringify(interviewerData, null, 2), 'success');
                
                // –ê–Ω–∞–ª–∏–∑–∏—Ä—É–µ–º –¥–∞–Ω–Ω—ã–µ
                const candidateSlots = candidateData.slots || [];
                const interviewerSlots = interviewerData.slots || [];
                
                addResult('üìä –ê–Ω–∞–ª–∏–∑ –¥–∞–Ω–Ω—ã—Ö', `
–ö–∞–Ω–¥–∏–¥–∞—Ç—ã: ${candidateSlots.length} —Å–ª–æ—Ç–æ–≤
–ò–Ω—Ç–µ—Ä–≤—å—é–µ—Ä—ã: ${interviewerSlots.length} —Å–ª–æ—Ç–æ–≤

–°–ª–æ—Ç—ã –∫–∞–Ω–¥–∏–¥–∞—Ç–æ–≤:
${candidateSlots.map(s => `‚Ä¢ ${s.time} (UTC: ${s.utcTime}) - ${s.count}`).join('\n')}

–°–ª–æ—Ç—ã –∏–Ω—Ç–µ—Ä–≤—å—é–µ—Ä–æ–≤:
${interviewerSlots.map(s => `‚Ä¢ ${s.time} (UTC: ${s.utcTime}) - ${s.count}`).join('\n')}
                `);
                
                // –ü—Ä–æ–≤–µ—Ä—è–µ–º —Å–ª–æ—Ç 23:00
                const candidateSlot23 = candidateSlots.find(s => s.time === '23:00');
                const interviewerSlot23 = interviewerSlots.find(s => s.time === '23:00');
                
                if (candidateSlot23) {
                    addResult('üéØ –°–ª–æ—Ç 23:00 –¥–ª—è –∫–∞–Ω–¥–∏–¥–∞—Ç–æ–≤', `–ù–∞–π–¥–µ–Ω: ${candidateSlot23.count}`, candidateSlot23.count > 0 ? 'success' : 'error');
                } else {
                    addResult('‚ùå –°–ª–æ—Ç 23:00 –¥–ª—è –∫–∞–Ω–¥–∏–¥–∞—Ç–æ–≤', '–ù–µ –Ω–∞–π–¥–µ–Ω', 'error');
                }
                
                if (interviewerSlot23) {
                    addResult('üéØ –°–ª–æ—Ç 23:00 –¥–ª—è –∏–Ω—Ç–µ—Ä–≤—å—é–µ—Ä–æ–≤', `–ù–∞–π–¥–µ–Ω: ${interviewerSlot23.count}`, interviewerSlot23.count > 0 ? 'success' : 'error');
                } else {
                    addResult('‚ùå –°–ª–æ—Ç 23:00 –¥–ª—è –∏–Ω—Ç–µ—Ä–≤—å—é–µ—Ä–æ–≤', '–ù–µ –Ω–∞–π–¥–µ–Ω', 'error');
                }
                
            } catch (error) {
                addResult('‚ùå –û—à–∏–±–∫–∞', error.message, 'error');
            }
        }
        
        async function addTestInterviewer() {
            addResult('üîÑ –î–æ–±–∞–≤–ª–µ–Ω–∏–µ —Ç–µ—Å—Ç–æ–≤–æ–≥–æ –∏–Ω—Ç–µ—Ä–≤—å—é–µ—Ä–∞', '–î–æ–±–∞–≤–ª—è–µ–º –∏–Ω—Ç–µ—Ä–≤—å—é–µ—Ä–∞ –≤ —Å–ª–æ—Ç 23:00...');
            
            try {
                const timezone = Intl.DateTimeFormat().resolvedOptions().timeZone;
                const now = new Date();
                const localDate = now.toISOString().slice(0, 10); // YYYY-MM-DD
                
                // –°–æ–∑–¥–∞–µ–º UTC –≤—Ä–µ–º—è –¥–ª—è —Å–ª–æ—Ç–∞ 23:00 –≤ –ª–æ–∫–∞–ª—å–Ω–æ–º –≤—Ä–µ–º–µ–Ω–∏
                const slotTime = '23:00';
                const [hours, minutes] = slotTime.split(':').map(Number);
                
                // –ö–æ–Ω–≤–µ—Ä—Ç–∏—Ä—É–µ–º –ª–æ–∫–∞–ª—å–Ω–æ–µ –≤—Ä–µ–º—è –≤ UTC
                // –î–ª—è —Å–ª–æ—Ç–∞ 23:00 –≤ Asia/Vladivostok (UTC+10) 
                // 23:00 –ª–æ–∫–∞–ª—å–Ω–æ–µ –≤—Ä–µ–º—è = 13:00 UTC
                const slotUtc = `${localDate}T13:00:00.000Z`;
                
                addResult('üìÖ –ò–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è –æ —Å–ª–æ—Ç–µ', `
–õ–æ–∫–∞–ª—å–Ω–æ–µ –≤—Ä–µ–º—è: ${slotTime}
–õ–æ–∫–∞–ª—å–Ω–∞—è –¥–∞—Ç–∞: ${localDate}
UTC –≤—Ä–µ–º—è: ${slotUtc}
–ß–∞—Å–æ–≤–æ–π –ø–æ—è—Å: ${timezone}
                `);
                
                // –î–æ–±–∞–≤–ª—è–µ–º –∏–Ω—Ç–µ—Ä–≤—å—é–µ—Ä–∞ —á–µ—Ä–µ–∑ API
                const response = await fetch('http://localhost:3000/api/slots/join', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                    },
                    body: JSON.stringify({
                        userId: 'test-interviewer-' + Date.now(),
                        role: 'interviewer',
                        profession: 'frontend',
                        language: 'ru',
                        slotUtc: slotUtc
                    })
                });
                
                const result = await response.json();
                
                if (response.ok) {
                    addResult('‚úÖ –ò–Ω—Ç–µ—Ä–≤—å—é–µ—Ä –¥–æ–±–∞–≤–ª–µ–Ω', JSON.stringify(result, null, 2), 'success');
                } else {
                    addResult('‚ùå –û—à–∏–±–∫–∞ –¥–æ–±–∞–≤–ª–µ–Ω–∏—è', JSON.stringify(result, null, 2), 'error');
                }
                
                // –ü—Ä–æ–≤–µ—Ä—è–µ–º —Ä–µ–∑—É–ª—å—Ç–∞—Ç
                setTimeout(checkDatabase, 1000);
                
            } catch (error) {
                addResult('‚ùå –û—à–∏–±–∫–∞', error.message, 'error');
            }
        }
        
        async function addTestCandidate() {
            addResult('üîÑ –î–æ–±–∞–≤–ª–µ–Ω–∏–µ —Ç–µ—Å—Ç–æ–≤–æ–≥–æ –∫–∞–Ω–¥–∏–¥–∞—Ç–∞', '–î–æ–±–∞–≤–ª—è–µ–º –∫–∞–Ω–¥–∏–¥–∞—Ç–∞ –≤ —Å–ª–æ—Ç 23:00...');
            
            try {
                const timezone = Intl.DateTimeFormat().resolvedOptions().timeZone;
                const now = new Date();
                const localDate = now.toISOString().slice(0, 10); // YYYY-MM-DD
                
                // –°–æ–∑–¥–∞–µ–º UTC –≤—Ä–µ–º—è –¥–ª—è —Å–ª–æ—Ç–∞ 23:00 –≤ –ª–æ–∫–∞–ª—å–Ω–æ–º –≤—Ä–µ–º–µ–Ω–∏
                const slotTime = '23:00';
                const [hours, minutes] = slotTime.split(':').map(Number);
                
                // –ö–æ–Ω–≤–µ—Ä—Ç–∏—Ä—É–µ–º –ª–æ–∫–∞–ª—å–Ω–æ–µ –≤—Ä–µ–º—è –≤ UTC
                // –î–ª—è —Å–ª–æ—Ç–∞ 23:00 –≤ Asia/Vladivostok (UTC+10) 
                // 23:00 –ª–æ–∫–∞–ª—å–Ω–æ–µ –≤—Ä–µ–º—è = 13:00 UTC
                const slotUtc = `${localDate}T13:00:00.000Z`;
                
                addResult('üìÖ –ò–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è –æ —Å–ª–æ—Ç–µ', `
–õ–æ–∫–∞–ª—å–Ω–æ–µ –≤—Ä–µ–º—è: ${slotTime}
–õ–æ–∫–∞–ª—å–Ω–∞—è –¥–∞—Ç–∞: ${localDate}
UTC –≤—Ä–µ–º—è: ${slotUtc}
–ß–∞—Å–æ–≤–æ–π –ø–æ—è—Å: ${timezone}
                `);
                
                // –î–æ–±–∞–≤–ª—è–µ–º –∫–∞–Ω–¥–∏–¥–∞—Ç–∞ —á–µ—Ä–µ–∑ API
                const response = await fetch('http://localhost:3000/api/slots/join', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                    },
                    body: JSON.stringify({
                        userId: 'test-candidate-' + Date.now(),
                        role: 'candidate',
                        profession: 'frontend',
                        language: 'ru',
                        slotUtc: slotUtc
                    })
                });
                
                const result = await response.json();
                
                if (response.ok) {
                    addResult('‚úÖ –ö–∞–Ω–¥–∏–¥–∞—Ç –¥–æ–±–∞–≤–ª–µ–Ω', JSON.stringify(result, null, 2), 'success');
                } else {
                    addResult('‚ùå –û—à–∏–±–∫–∞ –¥–æ–±–∞–≤–ª–µ–Ω–∏—è', JSON.stringify(result, null, 2), 'error');
                }
                
                // –ü—Ä–æ–≤–µ—Ä—è–µ–º —Ä–µ–∑—É–ª—å—Ç–∞—Ç
                setTimeout(checkDatabase, 1000);
                
            } catch (error) {
                addResult('‚ùå –û—à–∏–±–∫–∞', error.message, 'error');
            }
        }
        
        async function addTestCandidateCorrect() {
            addResult('üîÑ –î–æ–±–∞–≤–ª–µ–Ω–∏–µ –∫–∞–Ω–¥–∏–¥–∞—Ç–∞ –≤ –ø—Ä–∞–≤–∏–ª—å–Ω—ã–π —Å–ª–æ—Ç', '–î–æ–±–∞–≤–ª—è–µ–º –∫–∞–Ω–¥–∏–¥–∞—Ç–∞ –≤ —Å–ª–æ—Ç 23:00 (UTC 13:00)...');
            
            try {
                const timezone = Intl.DateTimeFormat().resolvedOptions().timeZone;
                const now = new Date();
                const localDate = now.toISOString().slice(0, 10); // YYYY-MM-DD
                
                // –°–æ–∑–¥–∞–µ–º UTC –≤—Ä–µ–º—è –¥–ª—è —Å–ª–æ—Ç–∞ 23:00 –≤ –ª–æ–∫–∞–ª—å–Ω–æ–º –≤—Ä–µ–º–µ–Ω–∏
                const slotTime = '23:00';
                
                // –ü—Ä–∞–≤–∏–ª—å–Ω–∞—è –∫–æ–Ω–≤–µ—Ä—Ç–∞—Ü–∏—è: 23:00 –ª–æ–∫–∞–ª—å–Ω–æ–µ –≤—Ä–µ–º—è = 13:00 UTC
                // –°–æ–∑–¥–∞–µ–º –¥–∞—Ç—É –≤ UTC –≤—Ä–µ–º–µ–Ω–∏ –Ω–∞–ø—Ä—è–º—É—é
                const slotUtc = `${localDate}T13:00:00.000Z`;
                
                addResult('üìÖ –ò–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è –æ —Å–ª–æ—Ç–µ', `
–õ–æ–∫–∞–ª—å–Ω–æ–µ –≤—Ä–µ–º—è: ${slotTime}
–õ–æ–∫–∞–ª—å–Ω–∞—è –¥–∞—Ç–∞: ${localDate}
UTC –≤—Ä–µ–º—è: ${slotUtc}
–ß–∞—Å–æ–≤–æ–π –ø–æ—è—Å: ${timezone}
                `);
                
                // –î–æ–±–∞–≤–ª—è–µ–º –∫–∞–Ω–¥–∏–¥–∞—Ç–∞ —á–µ—Ä–µ–∑ API
                const response = await fetch('http://localhost:3000/api/slots/join', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                    },
                    body: JSON.stringify({
                        userId: 'test-candidate-correct-' + Date.now(),
                        role: 'candidate',
                        profession: 'frontend',
                        language: 'ru',
                        slotUtc: slotUtc
                    })
                });
                
                const result = await response.json();
                
                if (response.ok) {
                    addResult('‚úÖ –ö–∞–Ω–¥–∏–¥–∞—Ç –¥–æ–±–∞–≤–ª–µ–Ω –≤ –ø—Ä–∞–≤–∏–ª—å–Ω—ã–π —Å–ª–æ—Ç', JSON.stringify(result, null, 2), 'success');
                } else {
                    addResult('‚ùå –û—à–∏–±–∫–∞ –¥–æ–±–∞–≤–ª–µ–Ω–∏—è', JSON.stringify(result, null, 2), 'error');
                }
                
                // –ü—Ä–æ–≤–µ—Ä—è–µ–º —Ä–µ–∑—É–ª—å—Ç–∞—Ç
                setTimeout(checkDatabase, 1000);
                
            } catch (error) {
                addResult('‚ùå –û—à–∏–±–∫–∞', error.message, 'error');
            }
        }
        
        async function addTestPair() {
            addResult('üîÑ –î–æ–±–∞–≤–ª–µ–Ω–∏–µ —Ç–µ—Å—Ç–æ–≤–æ–π –ø–∞—Ä—ã', '–î–æ–±–∞–≤–ª—è–µ–º –∫–∞–Ω–¥–∏–¥–∞—Ç–∞ –∏ –∏–Ω—Ç–µ—Ä–≤—å—é–µ—Ä–∞ –≤ —Å–ª–æ—Ç 23:00...');
            
            try {
                const timezone = Intl.DateTimeFormat().resolvedOptions().timeZone;
                const now = new Date();
                const localDate = now.toISOString().slice(0, 10); // YYYY-MM-DD
                
                // –°–æ–∑–¥–∞–µ–º UTC –≤—Ä–µ–º—è –¥–ª—è —Å–ª–æ—Ç–∞ 23:00 –≤ –ª–æ–∫–∞–ª—å–Ω–æ–º –≤—Ä–µ–º–µ–Ω–∏
                const slotTime = '23:00';
                const slotUtc = `${localDate}T13:00:00.000Z`;
                
                addResult('üìÖ –ò–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è –æ —Å–ª–æ—Ç–µ', `
–õ–æ–∫–∞–ª—å–Ω–æ–µ –≤—Ä–µ–º—è: ${slotTime}
–õ–æ–∫–∞–ª—å–Ω–∞—è –¥–∞—Ç–∞: ${localDate}
UTC –≤—Ä–µ–º—è: ${slotUtc}
–ß–∞—Å–æ–≤–æ–π –ø–æ—è—Å: ${timezone}
                `);
                
                // –î–æ–±–∞–≤–ª—è–µ–º –∏–Ω—Ç–µ—Ä–≤—å—é–µ—Ä–∞
                const interviewerResponse = await fetch('http://localhost:3000/api/slots/join', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                    },
                    body: JSON.stringify({
                        userId: 'test-interviewer-pair-' + Date.now(),
                        role: 'interviewer',
                        profession: 'frontend',
                        language: 'ru',
                        slotUtc: slotUtc
                    })
                });
                
                const interviewerResult = await interviewerResponse.json();
                
                if (interviewerResponse.ok) {
                    addResult('‚úÖ –ò–Ω—Ç–µ—Ä–≤—å—é–µ—Ä –¥–æ–±–∞–≤–ª–µ–Ω', JSON.stringify(interviewerResult, null, 2), 'success');
                } else {
                    addResult('‚ùå –û—à–∏–±–∫–∞ –¥–æ–±–∞–≤–ª–µ–Ω–∏—è –∏–Ω—Ç–µ—Ä–≤—å—é–µ—Ä–∞', JSON.stringify(interviewerResult, null, 2), 'error');
                }
                
                // –ñ–¥–µ–º –Ω–µ–º–Ω–æ–≥–æ
                await new Promise(resolve => setTimeout(resolve, 500));
                
                // –î–æ–±–∞–≤–ª—è–µ–º –∫–∞–Ω–¥–∏–¥–∞—Ç–∞
                const candidateResponse = await fetch('http://localhost:3000/api/slots/join', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                    },
                    body: JSON.stringify({
                        userId: 'test-candidate-pair-' + Date.now(),
                        role: 'candidate',
                        profession: 'frontend',
                        language: 'ru',
                        slotUtc: slotUtc
                    })
                });
                
                const candidateResult = await candidateResponse.json();
                
                if (candidateResponse.ok) {
                    addResult('‚úÖ –ö–∞–Ω–¥–∏–¥–∞—Ç –¥–æ–±–∞–≤–ª–µ–Ω', JSON.stringify(candidateResult, null, 2), 'success');
                } else {
                    addResult('‚ùå –û—à–∏–±–∫–∞ –¥–æ–±–∞–≤–ª–µ–Ω–∏—è –∫–∞–Ω–¥–∏–¥–∞—Ç–∞', JSON.stringify(candidateResult, null, 2), 'error');
                }
                
                // –ü—Ä–æ–≤–µ—Ä—è–µ–º —Ä–µ–∑—É–ª—å—Ç–∞—Ç
                setTimeout(checkDatabase, 1000);
                
            } catch (error) {
                addResult('‚ùå –û—à–∏–±–∫–∞', error.message, 'error');
            }
        }
        
        // –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∞—è –ø—Ä–æ–≤–µ—Ä–∫–∞ –ø—Ä–∏ –∑–∞–≥—Ä—É–∑–∫–µ —Å—Ç—Ä–∞–Ω–∏—Ü—ã
        window.onload = function() {
            addResult('üöÄ –°—Ç—Ä–∞–Ω–∏—Ü–∞ –∑–∞–≥—Ä—É–∂–µ–Ω–∞', '–ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∞—è –ø—Ä–æ–≤–µ—Ä–∫–∞ —á–µ—Ä–µ–∑ 2 —Å–µ–∫—É–Ω–¥—ã...');
            setTimeout(checkDatabase, 2000);
        };
    </script>
</body>
</html>
