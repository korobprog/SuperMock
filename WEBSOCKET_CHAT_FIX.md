# üîß –ò—Å–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –ø—Ä–æ–±–ª–µ–º—ã —Å WebSocket —á–∞—Ç–æ–º –≤ –ø—Ä–æ–¥–∞–∫—à–µ–Ω–µ

## üö® –ü—Ä–æ–±–ª–µ–º–∞
–ß–∞—Ç –º–µ–∂–¥—É —É—á–∞—Å—Ç–Ω–∏–∫–∞–º–∏ –Ω–∞ —Å—Ç—Ä–∞–Ω–∏—Ü–µ –æ–∂–∏–¥–∞–Ω–∏—è –Ω–µ —Ä–∞–±–æ—Ç–∞–µ—Ç –≤ –ø—Ä–æ–¥–∞–∫—à–µ–Ω–µ.

## üîç –ü—Ä–∏—á–∏–Ω–∞
**–ù–µ–ø—Ä–∞–≤–∏–ª—å–Ω–∞—è –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è WebSocket URL** –≤ –ø—Ä–æ–¥–∞–∫—à–µ–Ω–µ:

- **Frontend** –ø—ã—Ç–∞–µ—Ç—Å—è –ø–æ–¥–∫–ª—é—á–∏—Ç—å—Å—è –∫ `wss://app.supermock.ru` (frontend –¥–æ–º–µ–Ω)
- **–ù–æ WebSocket —Å–µ—Ä–≤–µ—Ä** –∑–∞–ø—É—â–µ–Ω –≤ backend –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–µ, –¥–æ—Å—Ç—É–ø–Ω–æ–º –ø–æ –∞–¥—Ä–µ—Å—É `wss://api.supermock.ru`

## ‚úÖ –†–µ—à–µ–Ω–∏–µ

### 1. –ò—Å–ø—Ä–∞–≤–ª–µ–Ω–∞ –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è WebSocket URL

**–§–∞–π–ª:** `frontend/src/lib/config.ts`
```typescript
// –ë—ã–ª–æ:
wsURL: import.meta.env.DEV 
  ? 'ws://localhost:3000'
  : 'wss://app.supermock.ru', // ‚ùå –ù–µ–ø—Ä–∞–≤–∏–ª—å–Ω–æ!

// –°—Ç–∞–ª–æ:
wsURL: import.meta.env.DEV 
  ? 'ws://localhost:3000'
  : (import.meta.env.VITE_WS_URL || 'wss://api.supermock.ru'), // ‚úÖ –ü—Ä–∞–≤–∏–ª—å–Ω–æ!
```

### 2. –î–æ–±–∞–≤–ª–µ–Ω–∞ –ø–µ—Ä–µ–º–µ–Ω–Ω–∞—è –æ–∫—Ä—É–∂–µ–Ω–∏—è

**–§–∞–π–ª:** `production.env`
```bash
VITE_WS_URL=wss://api.supermock.ru
```

### 3. –û–±–Ω–æ–≤–ª–µ–Ω docker-compose.prod-multi.yml

**Frontend –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä:**
```yaml
environment:
  - VITE_WS_URL=wss://api.supermock.ru
```

### 4. –£–ª—É—á—à–µ–Ω–æ –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ WebSocket

**–§–∞–π–ª:** `backend/server/index.mjs`
- –î–æ–±–∞–≤–ª–µ–Ω–æ –¥–µ—Ç–∞–ª—å–Ω–æ–µ –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ –≤—Å–µ—Ö WebSocket —Å–æ–±—ã—Ç–∏–π
- –õ–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ –ø–æ–¥–∫–ª—é—á–µ–Ω–∏–π, –æ—Ç–∫–ª—é—á–µ–Ω–∏–π, –ø—Ä–∏—Å–æ–µ–¥–∏–Ω–µ–Ω–∏–π –∫ –∫–æ–º–Ω–∞—Ç–∞–º
- –õ–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ —Å–æ–æ–±—â–µ–Ω–∏–π —á–∞—Ç–∞

## üöÄ –î–µ–ø–ª–æ–π –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏–π

### –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–π –¥–µ–ø–ª–æ–π —á–µ—Ä–µ–∑ GitHub Actions
```bash
git add .
git commit -m "fix: –∏—Å–ø—Ä–∞–≤–ª–µ–Ω WebSocket URL –¥–ª—è —á–∞—Ç–∞ –≤ –ø—Ä–æ–¥–∞–∫—à–µ–Ω–µ

- –ò—Å–ø—Ä–∞–≤–ª–µ–Ω WebSocket URL —Å app.supermock.ru –Ω–∞ api.supermock.ru
- –î–æ–±–∞–≤–ª–µ–Ω–∞ –ø–µ—Ä–µ–º–µ–Ω–Ω–∞—è –æ–∫—Ä—É–∂–µ–Ω–∏—è VITE_WS_URL
- –£–ª—É—á—à–µ–Ω–æ –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ WebSocket —Å–æ–±—ã—Ç–∏–π
- –û–±–Ω–æ–≤–ª–µ–Ω docker-compose –¥–ª—è –ø–µ—Ä–µ–¥–∞—á–∏ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã—Ö –æ–∫—Ä—É–∂–µ–Ω–∏—è"
git push origin main
```

### –†—É—á–Ω–æ–π –¥–µ–ø–ª–æ–π –Ω–∞ —Å–µ—Ä–≤–µ—Ä
```bash
# –ü–æ–¥–∫–ª—é—á–µ–Ω–∏–µ –∫ —Å–µ—Ä–≤–µ—Ä—É
ssh -i ~/.ssh/timeweb_vps_key root@217.198.6.238

# –ü–µ—Ä–µ—Ö–æ–¥ –≤ –¥–∏—Ä–µ–∫—Ç–æ—Ä–∏—é –ø—Ä–æ–µ–∫—Ç–∞
cd /opt/mockmate

# –û—Å—Ç–∞–Ω–æ–≤–∫–∞ –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–æ–≤
docker-compose -f docker-compose.prod-multi.yml down

# –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ —Ñ–∞–π–ª–æ–≤
# (—Å–∫–æ–ø–∏—Ä–æ–≤–∞—Ç—å –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–Ω—ã–µ —Ñ–∞–π–ª—ã)

# –ó–∞–ø—É—Å–∫ –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–æ–≤
docker-compose -f docker-compose.prod-multi.yml up -d --build

# –ü—Ä–æ–≤–µ—Ä–∫–∞ –ª–æ–≥–æ–≤
docker logs supermock-backend --tail 100 | grep -E '(socket|websocket|chat_message|join_room)'
```

## üß™ –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ

### 1. –¢–µ—Å—Ç–æ–≤—ã–π —Ñ–∞–π–ª
–ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ `websocket-test.html` –¥–ª—è –ø—Ä–æ–≤–µ—Ä–∫–∏ WebSocket —Å–æ–µ–¥–∏–Ω–µ–Ω–∏—è:

1. –û—Ç–∫—Ä–æ–π—Ç–µ —Ñ–∞–π–ª –≤ –±—Ä–∞—É–∑–µ—Ä–µ
2. –í—ã–±–µ—Ä–∏—Ç–µ `wss://api.supermock.ru`
3. –ù–∞–∂–º–∏—Ç–µ "–ü–æ–¥–∫–ª—é—á–∏—Ç—å—Å—è"
4. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –ª–æ–≥–∏ –≤ –∫–æ–Ω—Å–æ–ª–∏ –±—Ä–∞—É–∑–µ—Ä–∞

### 2. –ü—Ä–æ–≤–µ—Ä–∫–∞ –≤ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–∏
1. –û—Ç–∫—Ä–æ–π—Ç–µ —Å—Ç—Ä–∞–Ω–∏—Ü—É –æ–∂–∏–¥–∞–Ω–∏—è –≤ –ø—Ä–æ–¥–∞–∫—à–µ–Ω–µ
2. –û—Ç–∫—Ä–æ–π—Ç–µ DevTools ‚Üí Console
3. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –ª–æ–≥–∏ WebSocket —Å–æ–µ–¥–∏–Ω–µ–Ω–∏—è
4. –ü–æ–ø—Ä–æ–±—É–π—Ç–µ –æ—Ç–ø—Ä–∞–≤–∏—Ç—å —Å–æ–æ–±—â–µ–Ω–∏–µ –≤ —á–∞—Ç

### 3. –ü—Ä–æ–≤–µ—Ä–∫–∞ –ª–æ–≥–æ–≤ —Å–µ—Ä–≤–µ—Ä–∞
```bash
# –ü–æ–¥–∫–ª—é—á–µ–Ω–∏–µ –∫ —Å–µ—Ä–≤–µ—Ä—É
ssh -i ~/.ssh/timeweb_vps_key root@217.198.6.238

# –ü—Ä–æ—Å–º–æ—Ç—Ä –ª–æ–≥–æ–≤ backend
docker logs supermock-backend --tail 100 | grep -E '(socket|websocket|chat_message|join_room)'

# –ü—Ä–æ—Å–º–æ—Ç—Ä –≤—Å–µ—Ö –ª–æ–≥–æ–≤
docker logs supermock-backend --tail 200
```

## üìã –ß–µ–∫-–ª–∏—Å—Ç –ø—Ä–æ–≤–µ—Ä–∫–∏

- [ ] WebSocket URL –∏—Å–ø—Ä–∞–≤–ª–µ–Ω –Ω–∞ `wss://api.supermock.ru`
- [ ] –ü–µ—Ä–µ–º–µ–Ω–Ω–∞—è `VITE_WS_URL` –¥–æ–±–∞–≤–ª–µ–Ω–∞ –≤ `production.env`
- [ ] Docker-compose –æ–±–Ω–æ–≤–ª–µ–Ω –¥–ª—è –ø–µ—Ä–µ–¥–∞—á–∏ –ø–µ—Ä–µ–º–µ–Ω–Ω–æ–π
- [ ] –ö–æ–¥ –∑–∞–¥–µ–ø–ª–æ–µ–Ω –Ω–∞ —Å–µ—Ä–≤–µ—Ä
- [ ] –ö–æ–Ω—Ç–µ–π–Ω–µ—Ä—ã –ø–µ—Ä–µ–∑–∞–ø—É—â–µ–Ω—ã
- [ ] WebSocket —Å–æ–µ–¥–∏–Ω–µ–Ω–∏–µ —Ä–∞–±–æ—Ç–∞–µ—Ç (–ø—Ä–æ–≤–µ—Ä–µ–Ω–æ —á–µ—Ä–µ–∑ —Ç–µ—Å—Ç)
- [ ] –ß–∞—Ç —Ä–∞–±–æ—Ç–∞–µ—Ç –≤ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–∏
- [ ] –õ–æ–≥–∏ –ø–æ–∫–∞–∑—ã–≤–∞—é—Ç —É—Å–ø–µ—à–Ω—ã–µ WebSocket —Å–æ–±—ã—Ç–∏—è

## üîç –î–∏–∞–≥–Ω–æ—Å—Ç–∏–∫–∞ –ø—Ä–æ–±–ª–µ–º

### –ï—Å–ª–∏ WebSocket –≤—Å–µ –µ—â–µ –Ω–µ —Ä–∞–±–æ—Ç–∞–µ—Ç:

1. **–ü—Ä–æ–≤–µ—Ä—å—Ç–µ CORS –Ω–∞—Å—Ç—Ä–æ–π–∫–∏** –≤ backend
2. **–ü—Ä–æ–≤–µ—Ä—å—Ç–µ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –æ–∫—Ä—É–∂–µ–Ω–∏—è** –≤ –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–∞—Ö
3. **–ü—Ä–æ–≤–µ—Ä—å—Ç–µ –ª–æ–≥–∏ Traefik** –¥–ª—è –ø—Ä–æ–±–ª–µ–º —Å –º–∞—Ä—à—Ä—É—Ç–∏–∑–∞—Ü–∏–µ–π
4. **–ü—Ä–æ–≤–µ—Ä—å—Ç–µ SSL —Å–µ—Ä—Ç–∏—Ñ–∏–∫–∞—Ç—ã** –¥–ª—è WebSocket —Å–æ–µ–¥–∏–Ω–µ–Ω–∏–π

### –ü–æ–ª–µ–∑–Ω—ã–µ –∫–æ–º–∞–Ω–¥—ã –¥–ª—è –¥–∏–∞–≥–Ω–æ—Å—Ç–∏–∫–∏:
```bash
# –ü—Ä–æ–≤–µ—Ä–∫–∞ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã—Ö –æ–∫—Ä—É–∂–µ–Ω–∏—è –≤ –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–µ
docker exec supermock-backend env | grep VITE

# –ü—Ä–æ–≤–µ—Ä–∫–∞ —Å–µ—Ç–µ–≤—ã—Ö —Å–æ–µ–¥–∏–Ω–µ–Ω–∏–π
docker exec supermock-backend netstat -tlnp

# –ü—Ä–æ–≤–µ—Ä–∫–∞ CORS –∑–∞–≥–æ–ª–æ–≤–∫–æ–≤
curl -H "Origin: https://app.supermock.ru" \
     -H "Access-Control-Request-Method: POST" \
     -H "Access-Control-Request-Headers: Content-Type" \
     -X OPTIONS https://api.supermock.ru/api/health
```

## üìö –î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–µ —Ä–µ—Å—É—Ä—Å—ã

- [Socket.IO –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è](https://socket.io/docs/)
- [WebSocket CORS –Ω–∞—Å—Ç—Ä–æ–π–∫–∏](https://developer.mozilla.org/en-US/docs/Web/API/WebSockets_API/Writing_WebSocket_client_applications)
- [Docker Compose –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –æ–∫—Ä—É–∂–µ–Ω–∏—è](https://docs.docker.com/compose/environment-variables/)
