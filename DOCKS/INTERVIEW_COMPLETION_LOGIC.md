# üéØ –õ–æ–≥–∏–∫–∞ –∑–∞–≤–µ—Ä—à–µ–Ω–∏—è —Å–æ–±–µ—Å–µ–¥–æ–≤–∞–Ω–∏—è –∏ –º–∞—Ç—á–∏–Ω–≥–∞

## üìã –¢–µ–∫—É—â–µ–µ —Å–æ—Å—Ç–æ—è–Ω–∏–µ

### –ß—Ç–æ –ø—Ä–æ–∏—Å—Ö–æ–¥–∏—Ç —Å–µ–π—á–∞—Å:

1. –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –Ω–∞–∂–∏–º–∞–µ—Ç "–í—ã–π—Ç–∏" ‚Üí `handleExitInterview()`
2. –û—á–∏—â–∞—é—Ç—Å—è —Ä–µ—Å—É—Ä—Å—ã (—Ç–∞–π–º–µ—Ä, socket, WebRTC)
3. –ù–∞–≤–∏–≥–∞—Ü–∏—è –Ω–∞ –≥–ª–∞–≤–Ω—É—é —Å—Ç—Ä–∞–Ω–∏—Ü—É `/`
4. **–°–µ—Å—Å–∏—è –æ—Å—Ç–∞–µ—Ç—Å—è –≤ —Å—Ç–∞—Ç—É—Å–µ `scheduled`** (–Ω–µ –∑–∞–≤–µ—Ä—à–∞–µ—Ç—Å—è)
5. **–ù–µ—Ç —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–π –æ –∑–∞–≤–µ—Ä—à–µ–Ω–∏–∏**
6. **–ù–µ—Ç –∑–∞–ø—Ä–æ—Å–∞ –Ω–∞ —Ñ–∏–¥–±–µ–∫**

### –ü—Ä–æ–±–ª–µ–º—ã —Ç–µ–∫—É—â–µ–π —Ä–µ–∞–ª–∏–∑–∞—Ü–∏–∏:

- –°–µ—Å—Å–∏–∏ –Ω–µ –∑–∞–≤–µ—Ä—à–∞—é—Ç—Å—è –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ
- –ù–µ—Ç —Å–∏—Å—Ç–µ–º—ã —Ñ–∏–¥–±–µ–∫–∞
- –ù–µ—Ç —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–π –æ –∑–∞–≤–µ—Ä—à–µ–Ω–∏–∏
- –ù–µ—Ç —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∏ –∑–∞–≤–µ—Ä—à–µ–Ω–Ω—ã—Ö –∏–Ω—Ç–µ—Ä–≤—å—é
- –ù–µ—Ç –≤–æ–∑–º–æ–∂–Ω–æ—Å—Ç–∏ –æ—Å—Ç–∞–≤–∏—Ç—å –æ—Ç–∑—ã–≤ –ø–æ—Å–ª–µ –∑–∞–≤–µ—Ä—à–µ–Ω–∏—è

## üöÄ –ü—Ä–µ–¥–ª–∞–≥–∞–µ–º–∞—è —É–ª—É—á—à–µ–Ω–Ω–∞—è –ª–æ–≥–∏–∫–∞

### 1. –ó–∞–≤–µ—Ä—à–µ–Ω–∏–µ –∏–Ω—Ç–µ—Ä–≤—å—é (–∫–Ω–æ–ø–∫–∞ "–ó–∞–≤–µ—Ä—à–∏—Ç—å —Å–æ–±–µ—Å–µ–¥–æ–≤–∞–Ω–∏–µ")

#### Frontend (Interview.tsx):

```typescript
const handleCompleteInterview = async () => {
  try {
    // 1. –ó–∞–≤–µ—Ä—à–∏—Ç—å —Å–µ—Å—Å–∏—é –Ω–∞ —Å–µ—Ä–≤–µ—Ä–µ
    await apiCompleteSession(sessionId);

    // 2. –ü–æ–∫–∞–∑–∞—Ç—å –º–æ–¥–∞–ª—å–Ω–æ–µ –æ–∫–Ω–æ —Å —Ñ–∏–¥–±–µ–∫–æ–º
    setShowFeedbackModal(true);

    // 3. –û—á–∏—Å—Ç–∏—Ç—å —Ä–µ—Å—É—Ä—Å—ã
    cleanupResources();
  } catch (error) {
    console.error('Failed to complete interview:', error);
  }
};

const handleExitInterview = () => {
  // –ü–æ–∫–∞–∑–∞—Ç—å –¥–∏–∞–ª–æ–≥ –ø–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏—è
  setShowExitConfirmDialog(true);
};
```

#### Backend API (–Ω–æ–≤—ã–π —ç–Ω–¥–ø–æ–∏–Ω—Ç):

```javascript
// PUT /api/sessions/:id/complete
app.put('/api/sessions/:id/complete', async (req, res) => {
  try {
    const { id } = req.params;

    // 1. –û–±–Ω–æ–≤–∏—Ç—å —Å—Ç–∞—Ç—É—Å —Å–µ—Å—Å–∏–∏
    await prisma.session.update({
      where: { id },
      data: { status: 'completed' },
    });

    // 2. –°–æ–∑–¥–∞—Ç—å —É–≤–µ–¥–æ–º–ª–µ–Ω–∏—è –¥–ª—è —É—á–∞—Å—Ç–Ω–∏–∫–æ–≤
    const session = await prisma.session.findUnique({
      where: { id },
      include: { interviewer: true, candidate: true },
    });

    // 3. –û—Ç–ø—Ä–∞–≤–∏—Ç—å —É–≤–µ–¥–æ–º–ª–µ–Ω–∏—è –æ –∑–∞–≤–µ—Ä—à–µ–Ω–∏–∏
    await createCompletionNotifications(session);

    res.json({ success: true });
  } catch (error) {
    res.status(500).json({ error: 'Failed to complete session' });
  }
});
```

### 2. –ú–æ–¥–∞–ª—å–Ω–æ–µ –æ–∫–Ω–æ —Ñ–∏–¥–±–µ–∫–∞

#### –ö–æ–º–ø–æ–Ω–µ–Ω—Ç FeedbackModal:

```typescript
export function FeedbackModal({
  isOpen,
  onClose,
  onSubmit,
  sessionId,
  targetUser,
}) {
  const [rating, setRating] = useState(0);
  const [comments, setComments] = useState('');

  return (
    <Dialog open={isOpen} onOpenChange={onClose}>
      <DialogContent>
        <DialogTitle>–û—Å—Ç–∞–≤—å—Ç–µ —Ñ–∏–¥–±–µ–∫</DialogTitle>

        {/* –†–µ–π—Ç–∏–Ω–≥ –∑–≤–µ–∑–¥–∞–º–∏ */}
        <div className="flex justify-center space-x-2">
          {[1, 2, 3, 4, 5].map((star) => (
            <Button key={star} onClick={() => setRating(star)}>
              <Star className={rating >= star ? 'fill-yellow-400' : ''} />
            </Button>
          ))}
        </div>

        {/* –ö–æ–º–º–µ–Ω—Ç–∞—Ä–∏–π */}
        <Textarea
          placeholder="–í–∞—à–∏ –∫–æ–º–º–µ–Ω—Ç–∞—Ä–∏–∏..."
          value={comments}
          onChange={(e) => setComments(e.target.value)}
        />

        <Button onClick={() => onSubmit({ rating, comments })}>
          –û—Ç–ø—Ä–∞–≤–∏—Ç—å —Ñ–∏–¥–±–µ–∫
        </Button>
      </DialogContent>
    </Dialog>
  );
}
```

### 3. –£–ª—É—á—à–µ–Ω–Ω–∞—è —Å—Ç—Ä–∞–Ω–∏—Ü–∞ –∏—Å—Ç–æ—Ä–∏–∏

#### –î–æ–±–∞–≤–∏—Ç—å –≤ History.tsx:

```typescript
// –ö–Ω–æ–ø–∫–∞ "–û—Å—Ç–∞–≤–∏—Ç—å —Ñ–∏–¥–±–µ–∫" –¥–ª—è –∑–∞–≤–µ—Ä—à–µ–Ω–Ω—ã—Ö —Å–µ—Å—Å–∏–π
const canGiveFeedback = (session) => {
  const hasGivenFeedback = sessionFeedbacks.some(
    (f) => f.from_user_id === userId
  );
  return session.status === 'completed' && !hasGivenFeedback;
};

// –í –∫–∞—Ä—Ç–æ—á–∫–µ —Å–µ—Å—Å–∏–∏:
{
  canGiveFeedback(session) && (
    <Button onClick={() => setShowFeedbackModal(true)}>
      <Star className="mr-2" />
      –û—Å—Ç–∞–≤–∏—Ç—å —Ñ–∏–¥–±–µ–∫
    </Button>
  );
}
```

## üîÑ –ü–æ–ª–Ω—ã–π flow –∑–∞–≤–µ—Ä—à–µ–Ω–∏—è –∏–Ω—Ç–µ—Ä–≤—å—é

### –°—Ü–µ–Ω–∞—Ä–∏–π 1: –ó–∞–≤–µ—Ä—à–µ–Ω–∏–µ —á–µ—Ä–µ–∑ –∫–Ω–æ–ø–∫—É "–ó–∞–≤–µ—Ä—à–∏—Ç—å —Å–æ–±–µ—Å–µ–¥–æ–≤–∞–Ω–∏–µ"

1. –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –Ω–∞–∂–∏–º–∞–µ—Ç "–ó–∞–≤–µ—Ä—à–∏—Ç—å —Å–æ–±–µ—Å–µ–¥–æ–≤–∞–Ω–∏–µ"
2. –°–µ—Å—Å–∏—è –ø–æ–º–µ—á–∞–µ—Ç—Å—è –∫–∞–∫ `completed`
3. –°–æ–∑–¥–∞—é—Ç—Å—è —É–≤–µ–¥–æ–º–ª–µ–Ω–∏—è –¥–ª—è –æ–±–æ–∏—Ö —É—á–∞—Å—Ç–Ω–∏–∫–æ–≤
4. –ü–æ–∫–∞–∑—ã–≤–∞–µ—Ç—Å—è –º–æ–¥–∞–ª—å–Ω–æ–µ –æ–∫–Ω–æ —Ñ–∏–¥–±–µ–∫–∞
5. –ü–æ—Å–ª–µ –æ—Ç–ø—Ä–∞–≤–∫–∏ —Ñ–∏–¥–±–µ–∫–∞ ‚Üí –ø–µ—Ä–µ—Ö–æ–¥ –≤ –∏—Å—Ç–æ—Ä–∏—é

### –°—Ü–µ–Ω–∞—Ä–∏–π 2: –í—ã—Ö–æ–¥ –±–µ–∑ –∑–∞–≤–µ—Ä—à–µ–Ω–∏—è

1. –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –Ω–∞–∂–∏–º–∞–µ—Ç "–í—ã–π—Ç–∏"
2. –ü–æ–∫–∞–∑—ã–≤–∞–µ—Ç—Å—è –¥–∏–∞–ª–æ–≥ –ø–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏—è
3. –ï—Å–ª–∏ –ø–æ–¥—Ç–≤–µ—Ä–∂–¥–∞–µ—Ç ‚Üí —Å–µ—Å—Å–∏—è –æ—Å—Ç–∞–µ—Ç—Å—è `scheduled`
4. –ï—Å–ª–∏ –æ—Ç–º–µ–Ω—è–µ—Ç ‚Üí –≤–æ–∑–≤—Ä–∞—Ç –∫ –∏–Ω—Ç–µ—Ä–≤—å—é

### –°—Ü–µ–Ω–∞—Ä–∏–π 3: –ü–æ–ª—É—á–µ–Ω–∏–µ —É–≤–µ–¥–æ–º–ª–µ–Ω–∏—è –æ –∑–∞–≤–µ—Ä—à–µ–Ω–∏–∏

1. –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –ø–æ–ª—É—á–∞–µ—Ç —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–µ
2. –ù–∞–∂–∏–º–∞–µ—Ç "–û—Å—Ç–∞–≤–∏—Ç—å —Ñ–∏–¥–±–µ–∫"
3. –û—Ç–∫—Ä—ã–≤–∞–µ—Ç—Å—è –º–æ–¥–∞–ª—å–Ω–æ–µ –æ–∫–Ω–æ —Ñ–∏–¥–±–µ–∫–∞
4. –ü–æ—Å–ª–µ –æ—Ç–ø—Ä–∞–≤–∫–∏ ‚Üí —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–µ –ø–æ–º–µ—á–∞–µ—Ç—Å—è –∫–∞–∫ –ø—Ä–æ—á–∏—Ç–∞–Ω–Ω–æ–µ

## üìä –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ –∏ –∞–Ω–∞–ª–∏—Ç–∏–∫–∞

### –ú–µ—Ç—Ä–∏–∫–∏ –¥–ª—è –æ—Ç—Å–ª–µ–∂–∏–≤–∞–Ω–∏—è:

- –ö–æ–ª–∏—á–µ—Å—Ç–≤–æ –∑–∞–≤–µ—Ä—à–µ–Ω–Ω—ã—Ö –∏–Ω—Ç–µ—Ä–≤—å—é
- –ü—Ä–æ—Ü–µ–Ω—Ç –æ—Å—Ç–∞–≤–ª–µ–Ω–Ω—ã—Ö —Ñ–∏–¥–±–µ–∫–æ–≤
- –°—Ä–µ–¥–Ω–∏–π —Ä–µ–π—Ç–∏–Ω–≥ –ø–æ —Ä–æ–ª—è–º/–ø—Ä–æ—Ñ–µ—Å—Å–∏—è–º
- –í—Ä–µ–º—è –¥–æ –æ—Ç–ø—Ä–∞–≤–∫–∏ —Ñ–∏–¥–±–µ–∫–∞

### –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–µ –¥–µ–π—Å—Ç–≤–∏—è:

- –ù–∞–ø–æ–º–∏–Ω–∞–Ω–∏–µ –æ —Ñ–∏–¥–±–µ–∫–µ —á–µ—Ä–µ–∑ 24 —á–∞—Å–∞
- –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–µ –∑–∞–≤–µ—Ä—à–µ–Ω–∏–µ —Å–µ—Å—Å–∏–π —Å—Ç–∞—Ä—à–µ 2 —á–∞—Å–æ–≤
- –£–≤–µ–¥–æ–º–ª–µ–Ω–∏—è –æ –≤—ã—Å–æ–∫–∏—Ö —Ä–µ–π—Ç–∏–Ω–≥–∞—Ö

## üéØ –°–ª–µ–¥—É—é—â–∏–µ —à–∞–≥–∏

1. ‚úÖ –°–æ–∑–¥–∞—Ç—å API —ç–Ω–¥–ø–æ–∏–Ω—Ç `/api/sessions/:id/complete`
2. ‚úÖ –î–æ–±–∞–≤–∏—Ç—å –∫–æ–º–ø–æ–Ω–µ–Ω—Ç `FeedbackModal`
3. ‚úÖ –û–±–Ω–æ–≤–∏—Ç—å `Interview.tsx` —Å –Ω–æ–≤–æ–π –ª–æ–≥–∏–∫–æ–π –∑–∞–≤–µ—Ä—à–µ–Ω–∏—è
4. ‚úÖ –£–ª—É—á—à–∏—Ç—å —Å—Ç—Ä–∞–Ω–∏—Ü—É `History.tsx`
5. ‚úÖ –î–æ–±–∞–≤–∏—Ç—å –æ–±—Ä–∞–±–æ—Ç–∫—É –Ω–æ–≤—ã—Ö —Ç–∏–ø–æ–≤ —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–π
6. ‚úÖ –°–æ–∑–¥–∞—Ç—å –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–µ –Ω–∞–ø–æ–º–∏–Ω–∞–Ω–∏—è –æ —Ñ–∏–¥–±–µ–∫–µ

## üìù API Endpoints

### –ù–æ–≤—ã–µ —ç–Ω–¥–ø–æ–∏–Ω—Ç—ã:

#### 1. –ó–∞–≤–µ—Ä—à–µ–Ω–∏–µ —Å–µ—Å—Å–∏–∏

```
PUT /api/sessions/:id/complete
```

#### 2. –ü–æ–ª—É—á–µ–Ω–∏–µ –∏—Å—Ç–æ—Ä–∏–∏ —Å —Ñ–∏–¥–±–µ–∫–∞–º–∏

```
GET /api/history/:userId
```

#### 3. –û—Ç–ø—Ä–∞–≤–∫–∞ —Ñ–∏–¥–±–µ–∫–∞

```
POST /api/feedback
```

#### 4. –ù–∞–ø–æ–º–∏–Ω–∞–Ω–∏—è –æ —Ñ–∏–¥–±–µ–∫–µ

```
POST /api/notifications/feedback-reminder
```

## üóÑÔ∏è –ë–∞–∑–∞ –¥–∞–Ω–Ω—ã—Ö

### –û–±–Ω–æ–≤–ª–µ–Ω–∏—è —Å—Ö–µ–º—ã:

- –î–æ–±–∞–≤–∏—Ç—å –ø–æ–ª–µ `completed_at` –≤ —Ç–∞–±–ª–∏—Ü—É `sessions`
- –î–æ–±–∞–≤–∏—Ç—å –ø–æ–ª–µ `feedback_reminder_sent` –≤ —Ç–∞–±–ª–∏—Ü—É `notifications`
- –°–æ–∑–¥–∞—Ç—å –∏–Ω–¥–µ–∫—Å—ã –¥–ª—è –æ–ø—Ç–∏–º–∏–∑–∞—Ü–∏–∏ –∑–∞–ø—Ä–æ—Å–æ–≤ –∏—Å—Ç–æ—Ä–∏–∏

### –ú–∏–≥—Ä–∞—Ü–∏–∏:

```sql
-- –î–æ–±–∞–≤–∏—Ç—å –ø–æ–ª–µ completed_at
ALTER TABLE sessions ADD COLUMN completed_at TIMESTAMP;

-- –î–æ–±–∞–≤–∏—Ç—å –ø–æ–ª–µ –¥–ª—è –Ω–∞–ø–æ–º–∏–Ω–∞–Ω–∏–π –æ —Ñ–∏–¥–±–µ–∫–µ
ALTER TABLE notifications ADD COLUMN feedback_reminder_sent BOOLEAN DEFAULT FALSE;

-- –ò–Ω–¥–µ–∫—Å—ã –¥–ª—è –æ–ø—Ç–∏–º–∏–∑–∞—Ü–∏–∏
CREATE INDEX idx_sessions_status_completed ON sessions(status, completed_at);
CREATE INDEX idx_feedback_session_created ON feedback(session_id, created_at);
```

## üîß –†–µ–∞–ª–∏–∑–∞—Ü–∏—è

### 1. Backend –∏–∑–º–µ–Ω–µ–Ω–∏—è:

- –î–æ–±–∞–≤–∏—Ç—å —ç–Ω–¥–ø–æ–∏–Ω—Ç –∑–∞–≤–µ—Ä—à–µ–Ω–∏—è —Å–µ—Å—Å–∏–∏
- –û–±–Ω–æ–≤–∏—Ç—å –ª–æ–≥–∏–∫—É —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–π
- –î–æ–±–∞–≤–∏—Ç—å –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–µ –Ω–∞–ø–æ–º–∏–Ω–∞–Ω–∏—è
- –£–ª—É—á—à–∏—Ç—å API –∏—Å—Ç–æ—Ä–∏–∏

### 2. Frontend –∏–∑–º–µ–Ω–µ–Ω–∏—è:

- –°–æ–∑–¥–∞—Ç—å –∫–æ–º–ø–æ–Ω–µ–Ω—Ç FeedbackModal
- –û–±–Ω–æ–≤–∏—Ç—å Interview.tsx
- –£–ª—É—á—à–∏—Ç—å History.tsx
- –î–æ–±–∞–≤–∏—Ç—å –Ω–æ–≤—ã–µ –ø–µ—Ä–µ–≤–æ–¥—ã

### 3. –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ:

- –¢–µ—Å—Ç—ã –¥–ª—è –Ω–æ–≤—ã—Ö API —ç–Ω–¥–ø–æ–∏–Ω—Ç–æ–≤
- E2E —Ç–µ—Å—Ç—ã –¥–ª—è flow –∑–∞–≤–µ—Ä—à–µ–Ω–∏—è
- –¢–µ—Å—Ç—ã –∫–æ–º–ø–æ–Ω–µ–Ω—Ç–æ–≤ UI
- –¢–µ—Å—Ç—ã –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏–∏ —Å —É–≤–µ–¥–æ–º–ª–µ–Ω–∏—è–º–∏
