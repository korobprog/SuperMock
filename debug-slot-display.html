<!DOCTYPE html>
<html>
<head>
    <title>–û—Ç–ª–∞–¥–∫–∞ –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏—è —Å–ª–æ—Ç–æ–≤</title>
    <meta charset="UTF-8">
    <style>
        body { font-family: Arial, sans-serif; margin: 20px; }
        .debug-section { margin: 20px 0; padding: 15px; border: 1px solid #ddd; border-radius: 5px; }
        .success { background-color: #d4edda; border-color: #c3e6cb; }
        .error { background-color: #f8d7da; border-color: #f5c6cb; }
        .info { background-color: #d1ecf1; border-color: #bee5eb; }
        button { padding: 10px 15px; margin: 5px; cursor: pointer; }
        pre { background: #f8f9fa; padding: 10px; border-radius: 3px; overflow-x: auto; }
        .slot-card { 
            display: inline-block; 
            padding: 15px; 
            margin: 10px; 
            border: 1px solid #ddd; 
            border-radius: 8px; 
            background: white;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
        }
        .slot-time { font-size: 18px; font-weight: bold; margin-bottom: 5px; }
        .slot-utc { font-size: 12px; color: #666; margin-bottom: 5px; }
        .slot-count { font-size: 14px; color: #333; }
    </style>
</head>
<body>
    <h1>üîç –û—Ç–ª–∞–¥–∫–∞ –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏—è —Å–ª–æ—Ç–æ–≤</h1>
    
    <div class="debug-section info">
        <h3>üìã –ò–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è –æ —á–∞—Å–æ–≤–æ–º –ø–æ—è—Å–µ</h3>
        <div id="timezone-info"></div>
    </div>

    <div class="debug-section">
        <h3>üéØ –¢–µ—Å—Ç API –¥–ª—è –∫–∞–Ω–¥–∏–¥–∞—Ç–∞</h3>
        <button onclick="testCandidateAPI()">–ü—Ä–æ–≤–µ—Ä–∏—Ç—å API –¥–ª—è –∫–∞–Ω–¥–∏–¥–∞—Ç–∞</button>
        <div id="candidate-result"></div>
    </div>

    <div class="debug-section">
        <h3>üéØ –°–∏–º—É–ª—è—Ü–∏—è –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏—è —Å–ª–æ—Ç–æ–≤</h3>
        <button onclick="simulateSlotDisplay()">–°–∏–º—É–ª–∏—Ä–æ–≤–∞—Ç—å –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏–µ</button>
        <div id="slot-display"></div>
    </div>

    <div class="debug-section">
        <h3>üéØ –ü—Ä–æ–≤–µ—Ä–∫–∞ –¥–∞–Ω–Ω—ã—Ö –≤ —Ä–µ–∞–ª—å–Ω–æ–º –≤—Ä–µ–º–µ–Ω–∏</h3>
        <button onclick="checkRealTime()">–ü—Ä–æ–≤–µ—Ä–∏—Ç—å —Å–µ–π—á–∞—Å</button>
        <div id="realtime-result"></div>
    </div>

    <script>
        // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—é –æ —á–∞—Å–æ–≤–æ–º –ø–æ—è—Å–µ
        function showTimezoneInfo() {
            const timezone = Intl.DateTimeFormat().resolvedOptions().timeZone;
            const now = new Date();
            const offset = now.getTimezoneOffset();
            const offsetHours = Math.abs(offset) / 60;
            const offsetSign = offset <= 0 ? '+' : '-';
            
            const infoDiv = document.getElementById('timezone-info');
            infoDiv.innerHTML = `
                <p><strong>–ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –æ–ø—Ä–µ–¥–µ–ª–µ–Ω–Ω—ã–π —á–∞—Å–æ–≤–æ–π –ø–æ—è—Å:</strong> ${timezone}</p>
                <p><strong>–°–º–µ—â–µ–Ω–∏–µ –æ—Ç UTC:</strong> ${offsetSign}${offsetHours}:00</p>
                <p><strong>–¢–µ–∫—É—â–µ–µ –≤—Ä–µ–º—è:</strong> ${now.toLocaleString()}</p>
                <p><strong>UTC –≤—Ä–µ–º—è:</strong> ${now.toUTCString()}</p>
            `;
        }

        async function testCandidateAPI() {
            const resultDiv = document.getElementById('candidate-result');
            resultDiv.innerHTML = '<p>üîÑ –ó–∞–≥—Ä—É–∑–∫–∞...</p>';
            
            try {
                const timezone = Intl.DateTimeFormat().resolvedOptions().timeZone;
                const response = await fetch(`http://localhost:3000/api/slots/enhanced?role=candidate&profession=frontend&language=ru&timezone=${encodeURIComponent(timezone)}`);
                const data = await response.json();
                
                let html = '<div class="success">';
                html += '<h4>‚úÖ –†–µ–∑—É–ª—å—Ç–∞—Ç API:</h4>';
                html += `<p><strong>–ß–∞—Å–æ–≤–æ–π –ø–æ—è—Å:</strong> ${data.timezone?.name}</p>`;
                html += `<p><strong>–í—Å–µ–≥–æ —Å–ª–æ—Ç–æ–≤:</strong> ${data.slots?.length || 0}</p>`;
                
                if (data.slots && data.slots.length > 0) {
                    html += '<h5>–°–ª–æ—Ç—ã —Å –∏–Ω—Ç–µ—Ä–≤—å—é–µ—Ä–∞–º–∏:</h5>';
                    data.slots.forEach(slot => {
                        const status = slot.count > 0 ? '‚úÖ' : '‚ùå';
                        html += `<p>${status} ${slot.time} (UTC: ${slot.utcTime}) - ${slot.count} –∏–Ω—Ç–µ—Ä–≤—å—é–µ—Ä(–æ–≤)</p>`;
                    });
                } else {
                    html += '<p><strong>–ù–µ—Ç –¥–æ—Å—Ç—É–ø–Ω—ã—Ö —Å–ª–æ—Ç–æ–≤!</strong></p>';
                }
                
                html += '<h5>–ü–æ–ª–Ω—ã–π –æ—Ç–≤–µ—Ç API:</h5>';
                html += `<pre>${JSON.stringify(data, null, 2)}</pre>`;
                html += '</div>';
                
                resultDiv.innerHTML = html;
                
                // –°–æ—Ö—Ä–∞–Ω—è–µ–º –¥–∞–Ω–Ω—ã–µ –¥–ª—è —Å–∏–º—É–ª—è—Ü–∏–∏
                window.lastApiData = data;
                
            } catch (error) {
                resultDiv.innerHTML = `<div class="error"><h4>‚ùå –û—à–∏–±–∫–∞:</h4><p>${error.message}</p></div>`;
            }
        }

        function simulateSlotDisplay() {
            const displayDiv = document.getElementById('slot-display');
            
            if (!window.lastApiData) {
                displayDiv.innerHTML = '<div class="error"><p>‚ùå –°–Ω–∞—á–∞–ª–∞ –ø–æ–ª—É—á–∏—Ç–µ –¥–∞–Ω–Ω—ã–µ API</p></div>';
                return;
            }
            
            const data = window.lastApiData;
            let html = '<div class="info">';
            html += '<h4>üé® –°–∏–º—É–ª—è—Ü–∏—è –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏—è —Å–ª–æ—Ç–æ–≤:</h4>';
            
            if (data.slots && data.slots.length > 0) {
                data.slots.forEach(slot => {
                    html += `
                        <div class="slot-card">
                            <div class="slot-time">${slot.time}</div>
                            <div class="slot-utc">UTC: ${slot.utcTime}</div>
                            <div class="slot-count">${slot.count} –ò–Ω—Ç.</div>
                        </div>
                    `;
                });
            } else {
                html += '<p><strong>–ù–µ—Ç —Å–ª–æ—Ç–æ–≤ –¥–ª—è –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏—è</strong></p>';
            }
            
            html += '</div>';
            displayDiv.innerHTML = html;
        }

        async function checkRealTime() {
            const resultDiv = document.getElementById('realtime-result');
            resultDiv.innerHTML = '<p>üîÑ –ü—Ä–æ–≤–µ—Ä–∫–∞ –≤ —Ä–µ–∞–ª—å–Ω–æ–º –≤—Ä–µ–º–µ–Ω–∏...</p>';
            
            try {
                const timezone = Intl.DateTimeFormat().resolvedOptions().timeZone;
                const response = await fetch(`http://localhost:3000/api/slots/enhanced?role=candidate&profession=frontend&language=ru&timezone=${encodeURIComponent(timezone)}`);
                const data = await response.json();
                
                let html = '<div class="success">';
                html += '<h4>‚úÖ –î–∞–Ω–Ω—ã–µ –≤ —Ä–µ–∞–ª—å–Ω–æ–º –≤—Ä–µ–º–µ–Ω–∏:</h4>';
                html += `<p><strong>–í—Ä–µ–º—è –∑–∞–ø—Ä–æ—Å–∞:</strong> ${new Date().toLocaleString()}</p>`;
                html += `<p><strong>–ß–∞—Å–æ–≤–æ–π –ø–æ—è—Å:</strong> ${data.timezone?.name}</p>`;
                
                // –ò—â–µ–º —Å–ª–æ—Ç 23:00
                const slot23 = data.slots?.find(slot => slot.time === '23:00');
                if (slot23) {
                    html += `<p><strong>üéØ –°–ª–æ—Ç 23:00 –Ω–∞–π–¥–µ–Ω:</strong> ${slot23.count} –∏–Ω—Ç–µ—Ä–≤—å—é–µ—Ä(–æ–≤)</p>`;
                } else {
                    html += '<p><strong>‚ùå –°–ª–æ—Ç 23:00 –Ω–µ –Ω–∞–π–¥–µ–Ω!</strong></p>';
                }
                
                html += '<h5>–í—Å–µ —Å–ª–æ—Ç—ã:</h5>';
                if (data.slots && data.slots.length > 0) {
                    data.slots.forEach(slot => {
                        html += `<p>‚Ä¢ ${slot.time} (UTC: ${slot.utcTime}) - ${slot.count} –∏–Ω—Ç–µ—Ä–≤—å—é–µ—Ä(–æ–≤)</p>`;
                    });
                } else {
                    html += '<p>–ù–µ—Ç —Å–ª–æ—Ç–æ–≤</p>';
                }
                
                html += '</div>';
                resultDiv.innerHTML = html;
                
            } catch (error) {
                resultDiv.innerHTML = `<div class="error"><h4>‚ùå –û—à–∏–±–∫–∞:</h4><p>${error.message}</p></div>`;
            }
        }

        // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—é –ø—Ä–∏ –∑–∞–≥—Ä—É–∑–∫–µ
        showTimezoneInfo();
    </script>
</body>
</html>
