# Улучшенные скрипты деплоя Super Mock

## Обзор

Система деплоя была улучшена для автоматического исправления распространенных проблем, таких как:
- Ошибки базы данных (отсутствующие колонки, невыполненные миграции)
- Проблемы с WebSocket соединениями
- Проблемы с CORS и конфигурацией

## Новые скрипты

### 1. `fix-database.sh`
Автоматически исправляет проблемы с базой данных:
- Проверяет статус миграций Prisma
- Синхронизирует схему базы данных
- Генерирует Prisma Client
- Перезапускает бэкенд для применения изменений

**Использование:**
```bash
bash scripts/deploy/fix-database.sh
```

### 2. `fix-websocket.sh`
Проверяет и исправляет проблемы с WebSocket:
- Проверяет WebSocket endpoint
- Проверяет конфигурацию Traefik
- Проверяет конфигурацию docker-compose
- Показывает логи WebSocket соединений

**Использование:**
```bash
bash scripts/deploy/fix-websocket.sh
```

### 3. `health-check.sh`
Комплексная проверка здоровья всей системы:
- Проверяет все контейнеры
- Проверяет API (локальный и внешний)
- Проверяет WebSocket
- Проверяет сайт
- Проверяет базу данных и Redis
- Проверяет Traefik
- Автоматически исправляет обнаруженные проблемы

**Использование:**
```bash
bash scripts/deploy/health-check.sh
```

## Обновленные скрипты

### `deploy-backend.sh`
Теперь автоматически включает:
- Синхронизацию схемы базы данных
- Генерацию Prisma Client
- Проверку WebSocket endpoint
- Перезапуск бэкенда для применения изменений

### `deploy-all.sh`
Теперь автоматически включает:
- Все исправления из `deploy-backend.sh`
- Дополнительную проверку WebSocket

### `deploy-interactive.sh`
Добавлены новые опции:
- `8` - Исправить базу данных
- `9` - Исправить WebSocket
- `10` - Комплексная проверка здоровья
- `11` - Показать документацию

## Автоматические исправления

### Проблемы с базой данных
Скрипты автоматически исправляют:
- Отсутствующие колонки в таблицах
- Невыполненные миграции Prisma
- Проблемы с Prisma Client

### Проблемы с WebSocket
Скрипты автоматически исправляют:
- Проблемы с CORS конфигурацией
- Проблемы с конфигурацией Socket.IO
- Проблемы с проксированием через Traefik

## Рекомендуемый workflow

1. **Для обычного деплоя:**
   ```bash
   bash scripts/deploy/deploy-interactive.sh
   # Выберите опцию 3 (Обновить фронтенд и бэкенд)
   ```

2. **При проблемах с базой данных:**
   ```bash
   bash scripts/deploy/fix-database.sh
   ```

3. **При проблемах с WebSocket:**
   ```bash
   bash scripts/deploy/fix-websocket.sh
   ```

4. **Для комплексной диагностики:**
   ```bash
   bash scripts/deploy/health-check.sh
   ```

## Мониторинг

Все скрипты предоставляют подробную информацию о:
- Статусе выполнения операций
- Обнаруженных проблемах
- Выполненных исправлениях
- Итоговом состоянии системы

## Логирование

Скрипты логируют все действия и могут быть использованы для:
- Отладки проблем
- Аудита изменений
- Мониторинга состояния системы

## Безопасность

- Все операции выполняются с проверкой подключения к серверу
- Создаются бэкапы перед изменениями
- Используются безопасные команды с обработкой ошибок
- Проверяется здоровье системы после изменений
