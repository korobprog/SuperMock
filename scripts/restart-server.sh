#!/bin/bash
set -e

echo "üîÑ –ü–ï–†–ï–ó–ê–ü–£–°–ö –°–ï–†–í–ï–†–ê –î–õ–Ø –û–ß–ò–°–¢–ö–ò –ö–≠–®–ê DOCKER..."

# –û—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º –≤—Å–µ –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä—ã
echo "üõë –û—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º –≤—Å–µ –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä—ã..."
docker stop $(docker ps -aq) 2>/dev/null || true

# –ü–æ–ª–Ω–∞—è –æ—á–∏—Å—Ç–∫–∞ Docker
echo "üßπ –ü–æ–ª–Ω–∞—è –æ—á–∏—Å—Ç–∫–∞ Docker..."
docker system prune -a --volumes --force

# –û—á–∏—â–∞–µ–º –∫—ç—à buildx
echo "üßπ –û—á–∏—â–∞–µ–º –∫—ç—à buildx..."
docker buildx prune --all --force

# –°–æ—Ö—Ä–∞–Ω—è–µ–º –ª–æ–≥–∏ –ø–µ—Ä–µ–¥ –ø–µ—Ä–µ–∑–∞–ø—É—Å–∫–æ–º
echo "üìù –°–æ—Ö—Ä–∞–Ω—è–µ–º –ª–æ–≥–∏ –ø–µ—Ä–µ–¥ –ø–µ—Ä–µ–∑–∞–ø—É—Å–∫–æ–º..."
mkdir -p /tmp/server-logs
docker logs supermock-backend > /tmp/server-logs/backend.log 2>&1 || true
docker logs supermock-frontend > /tmp/server-logs/frontend.log 2>&1 || true

echo "‚ö†Ô∏è –í–ù–ò–ú–ê–ù–ò–ï: –°–µ—Ä–≤–µ—Ä –±—É–¥–µ—Ç –ø–µ—Ä–µ–∑–∞–ø—É—â–µ–Ω —á–µ—Ä–µ–∑ 10 —Å–µ–∫—É–Ω–¥!"
echo "–≠—Ç–æ –¥–æ–ª–∂–Ω–æ —Ä–µ—à–∏—Ç—å –ø—Ä–æ–±–ª–µ–º—É —Å –∫—ç—à–∏—Ä–æ–≤–∞–Ω–∏–µ–º Docker."
sleep 10

# –ü–µ—Ä–µ–∑–∞–ø—É—Å–∫–∞–µ–º —Å–µ—Ä–≤–µ—Ä
echo "üîÑ –ü–µ—Ä–µ–∑–∞–ø—É—Å–∫–∞–µ–º —Å–µ—Ä–≤–µ—Ä..."
sudo reboot
