# Управление базами данных в Docker

В этом проекте настроены две среды баз данных MongoDB и Redis:

- **Тестовая среда (DEV)** - для разработки и тестирования
- **Продакшен среда (PROD)** - для рабочего окружения

## Структура

- `docker-compose.dev.yml` - конфигурация тестовой среды
- `docker-compose.prod.yml` - конфигурация продакшен среды
- `.env.dev` - переменные окружения для тестовой среды
- `.env.prod` - переменные окружения для продакшен среды
- `scripts/db-dev.sh` - скрипт для запуска тестовой среды
- `scripts/db-prod.sh` - скрипт для запуска продакшен среды
- `scripts/db-status.sh` - скрипт для проверки статуса баз данных
- `scripts/db-stop-all.sh` - скрипт для остановки всех баз данных

## Порты и доступ

### Тестовая среда (DEV)

- MongoDB: `localhost:27018`
- Redis: `localhost:6380`
- Имя базы данных: `supermock_dev`
- Пользователь MongoDB: `admin`
- Пароль MongoDB: `dev-password`
- Пароль Redis: `dev-password`

### Продакшен среда (PROD)

- MongoDB: `localhost:27017`
- Redis: `localhost:6379`
- Имя базы данных: `supermock_prod`
- Пользователь MongoDB: `admin`
- Пароль MongoDB: `prod-password` (можно изменить через переменную окружения `MONGO_PROD_PASSWORD`)
- Пароль Redis: `prod-password` (можно изменить через переменную окружения `REDIS_PROD_PASSWORD`)

## Использование

### Запуск тестовой среды

```bash
npm run db:dev
```

или

```bash
./scripts/db-dev.sh
```

### Запуск продакшен среды

```bash
npm run db:prod
```

или

```bash
./scripts/db-prod.sh
```

### Проверка статуса баз данных

```bash
npm run db:status
```

или

```bash
./scripts/db-status.sh
```

### Остановка всех баз данных

```bash
npm run db:stop
```

или

```bash
./scripts/db-stop-all.sh
```

## Переключение между средами

При запуске скриптов `db-dev.sh` или `db-prod.sh` происходит автоматическое переключение между средами:

1. Останавливается другая среда, если она запущена
2. Запускается выбранная среда
3. Копируется соответствующий файл `.env.dev` или `.env.prod` в `.env`

## Безопасность

В продакшен среде:

- Включена аутентификация MongoDB
- Настроены ограничения на использование памяти
- Пароли могут быть заданы через переменные окружения

## Данные

Данные баз данных хранятся в Docker volumes:

- Тестовая среда: `mongo-dev-data` и `redis-dev-data`
- Продакшен среда: `mongo-prod-data` и `redis-prod-data`

Это обеспечивает сохранность данных между перезапусками контейнеров.

## Примечания

- Скрипты автоматически проверяют, запущена ли другая среда, и останавливают её перед запуском новой
- Для работы скриптов требуется Docker и docker-compose
- В продакшен среде рекомендуется изменить пароли через переменные окружения
