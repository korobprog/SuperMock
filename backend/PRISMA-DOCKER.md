# Синхронизация Prisma с MongoDB в Docker

Этот документ описывает процесс синхронизации схемы Prisma с MongoDB, запущенной в Docker-контейнере.

## Предварительные требования

1. Docker и Docker Compose установлены на вашей машине
2. Node.js и npm установлены на вашей машине
3. Проект настроен с Prisma и MongoDB

## Доступные скрипты

В проекте доступны следующие скрипты для работы с Prisma и MongoDB:

| Скрипт                    | Описание                                                         |
| ------------------------- | ---------------------------------------------------------------- |
| `npm run prisma:generate` | Генерирует Prisma клиент на основе схемы                         |
| `npm run prisma:push`     | Пушит схему Prisma в MongoDB, запущенную в Docker                |
| `npm run prisma:seed`     | Заполняет базу данных тестовыми данными                          |
| `npm run prisma:sync`     | Запускает полный процесс синхронизации (push + опционально seed) |

## Процесс синхронизации

### Автоматическая синхронизация

Для полной автоматической синхронизации выполните:

```bash
npm run prisma:sync
```

Этот скрипт выполнит следующие действия:

1. Проверит, запущен ли контейнер с MongoDB, и запустит его, если необходимо
2. Сгенерирует Prisma клиент
3. Пушит схему Prisma в MongoDB
4. Предложит заполнить базу данных тестовыми данными

### Ручная синхронизация

Если вы хотите выполнить шаги синхронизации по отдельности:

1. Запустите MongoDB в Docker:

   ```bash
   npm run db:dev
   ```

2. Сгенерируйте Prisma клиент:

   ```bash
   npm run prisma:generate
   ```

3. Пушите схему Prisma в MongoDB:

   ```bash
   npm run prisma:push
   ```

4. (Опционально) Заполните базу данных тестовыми данными:
   ```bash
   npm run prisma:seed
   ```

## Проверка статуса

Чтобы проверить статус базы данных:

```bash
npm run db:status
```

## Остановка базы данных

Чтобы остановить все контейнеры с базами данных:

```bash
npm run db:stop
```

## Структура тестовых данных

При заполнении базы данных тестовыми данными создаются следующие пользователи:

1. Тестовый пользователь:

   - Email: test@example.com
   - Пароль: test123

2. Администратор:
   - Email: admin@example.com
   - Пароль: admin123

## Устранение неполадок

### Проблемы с подключением к MongoDB

Если у вас возникают проблемы с подключением к MongoDB, убедитесь, что:

1. Docker запущен и работает корректно
2. Контейнер mongo-dev запущен (`docker ps`)
3. Порт 27018 не занят другим процессом
4. Переменная окружения MONGO_URI в файле .env настроена правильно

### Ошибки при генерации Prisma клиента

Если возникают ошибки при генерации Prisma клиента:

1. Убедитесь, что схема Prisma (schema.prisma) синтаксически корректна
2. Проверьте, что все зависимости установлены (`npm install`)
3. Попробуйте удалить директорию node_modules/.prisma и выполнить генерацию заново
