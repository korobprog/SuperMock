<!DOCTYPE html>
<html>
<head>
    <title>API Test</title>
    <meta charset="UTF-8">
    <style>
        body { font-family: Arial, sans-serif; margin: 20px; }
        .result { margin: 10px 0; padding: 10px; border: 1px solid #ccc; }
        .success { background-color: #d4edda; border-color: #c3e6cb; }
        .error { background-color: #f8d7da; border-color: #f5c6cb; }
        button { margin: 5px; padding: 10px; }
    </style>
</head>
<body>
    <h1>üîç –¢–µ—Å—Ç API –¥–ª—è Mahamanjari_dd</h1>
    
    <div>
        <h3>üì± –ò–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è –æ –±—Ä–∞—É–∑–µ—Ä–µ:</h3>
        <p><strong>–ß–∞—Å–æ–≤–æ–π –ø–æ—è—Å:</strong> <span id="timezone">–û–ø—Ä–µ–¥–µ–ª—è–µ—Ç—Å—è...</span></p>
        <p><strong>–¢–µ–∫—É—â–µ–µ –≤—Ä–µ–º—è:</strong> <span id="current-time">–û–ø—Ä–µ–¥–µ–ª—è–µ—Ç—Å—è...</span></p>
    </div>

    <div>
        <h3>üåê –¢–µ—Å—Ç API –∑–∞–ø—Ä–æ—Å–æ–≤:</h3>
        <button onclick="testVladivostok()">–¢–µ—Å—Ç Asia/Vladivostok</button>
        <button onclick="testMoscow()">–¢–µ—Å—Ç Europe/Moscow</button>
        <button onclick="testAuto()">–¢–µ—Å—Ç —Å –∞–≤—Ç–æ–æ–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ–º</button>
        <div id="results"></div>
    </div>

    <div>
        <h3>üîÑ –û—á–∏—Å—Ç–∫–∞ –∫—ç—à–∞:</h3>
        <button onclick="clearCache()">–û—á–∏—Å—Ç–∏—Ç—å –∫—ç—à –±—Ä–∞—É–∑–µ—Ä–∞</button>
        <button onclick="goToMainApp()">–ü–µ—Ä–µ–π—Ç–∏ –≤ –æ—Å–Ω–æ–≤–Ω–æ–µ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ</button>
    </div>

    <script>
        // –û–ø—Ä–µ–¥–µ–ª—è–µ–º —á–∞—Å–æ–≤–æ–π –ø–æ—è—Å
        function detectTimezone() {
            const timezone = Intl.DateTimeFormat().resolvedOptions().timeZone;
            const now = new Date();
            
            document.getElementById('timezone').textContent = timezone;
            document.getElementById('current-time').textContent = now.toLocaleString();
            
            console.log('üåç –ß–∞—Å–æ–≤–æ–π –ø–æ—è—Å:', timezone);
            return timezone;
        }

        // –¢–µ—Å—Ç–∏—Ä—É–µ–º API
        async function testAPI(timezone) {
            const resultsDiv = document.getElementById('results');
            resultsDiv.innerHTML = `<p>üîÑ –¢–µ—Å—Ç–∏—Ä—É–µ–º ${timezone}...</p>`;
            
            try {
                const response = await fetch(`https://api.supermock.ru/api/slots/enhanced?role=candidate&profession=frontend&language=ru&timezone=${encodeURIComponent(timezone)}`);
                
                if (!response.ok) {
                    throw new Error(`HTTP ${response.status}: ${response.statusText}`);
                }
                
                const data = await response.json();
                
                let html = `<div class="success">`;
                html += `<h4>‚úÖ –£—Å–ø–µ—à–Ω–æ –¥–ª—è ${timezone}:</h4>`;
                html += `<p><strong>–í—Å–µ–≥–æ —Å–ª–æ—Ç–æ–≤:</strong> ${data.slots.length}</p>`;
                
                // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º —Å–ª–æ—Ç—ã —Å –∏–Ω—Ç–µ—Ä–≤—å—é–µ—Ä–∞–º–∏
                const slotsWithInterviewers = data.slots.filter(slot => slot.count > 0);
                if (slotsWithInterviewers.length > 0) {
                    html += `<p><strong>üéØ –°–ª–æ—Ç—ã —Å –∏–Ω—Ç–µ—Ä–≤—å—é–µ—Ä–∞–º–∏:</strong></p>`;
                    slotsWithInterviewers.forEach(slot => {
                        html += `<p>‚Ä¢ <strong>${slot.time}</strong> (UTC: ${slot.utcTime}) - <strong>${slot.count} –∏–Ω—Ç–µ—Ä–≤—å—é–µ—Ä(–æ–≤)</strong></p>`;
                    });
                } else {
                    html += `<p><strong>‚ùå –ù–µ—Ç —Å–ª–æ—Ç–æ–≤ —Å –∏–Ω—Ç–µ—Ä–≤—å—é–µ—Ä–∞–º–∏</strong></p>`;
                }
                
                html += `</div>`;
                resultsDiv.innerHTML = html;
                
            } catch (error) {
                resultsDiv.innerHTML = `<div class="error"><h4>‚ùå –û—à–∏–±–∫–∞ –¥–ª—è ${timezone}:</h4><p>${error.message}</p></div>`;
            }
        }

        function testVladivostok() {
            testAPI('Asia/Vladivostok');
        }

        function testMoscow() {
            testAPI('Europe/Moscow');
        }

        function testAuto() {
            const timezone = detectTimezone();
            testAPI(timezone);
        }

        function clearCache() {
            console.log('üîÑ –û—á–∏—Å—Ç–∫–∞ –∫—ç—à–∞...');
            
            // –û—á–∏—â–∞–µ–º –∫—ç—à
            if ('caches' in window) {
                caches.keys().then(names => {
                    names.forEach(name => {
                        caches.delete(name);
                        console.log('üóëÔ∏è –£–¥–∞–ª–µ–Ω –∫—ç—à:', name);
                    });
                });
            }

            // –û—á–∏—â–∞–µ–º localStorage
            localStorage.clear();
            console.log('üóëÔ∏è –û—á–∏—â–µ–Ω localStorage');

            // –û—á–∏—â–∞–µ–º sessionStorage
            sessionStorage.clear();
            console.log('üóëÔ∏è –û—á–∏—â–µ–Ω sessionStorage');

            alert('‚úÖ –ö—ç—à –æ—á–∏—â–µ–Ω! –¢–µ–ø–µ—Ä—å –ø–µ—Ä–µ–∑–∞–≥—Ä—É–∑–∏—Ç–µ –æ—Å–Ω–æ–≤–Ω–æ–µ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ.');
        }

        function goToMainApp() {
            window.location.href = '/time';
        }

        // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è
        window.onload = function() {
            detectTimezone();
            console.log('üöÄ –°—Ç—Ä–∞–Ω–∏—Ü–∞ –∑–∞–≥—Ä—É–∂–µ–Ω–∞');
        };
    </script>
</body>
</html>
